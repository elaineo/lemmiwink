{% extends "base/app.html" %}
{% block content %}
    <div id="homepage_content" data-role="content">
      <div class="page-subtitle">
        Upload a photo of your Registration ID.
      </div>
      <input type="file" capture="camera" accept="image/*" id="photoID">
      <input type="button" class="button small info" value="Save" id='save_b
tn' disabled>
      <img style="display:none;width:60px;height:60px;" id="smallImage" src="" />
      <img style="display:none;" id="largeImage" src="" />
      <div id="img-prev"></div>
    </div><!-- /content -->

<script type="text/javascript" src="/static/js/save_image.js"></script>
<script>
$(document).ready(function(){
    $('#save_btn').click(function(event){
      event.preventDefault();
      $('#save_btn').attr('disabled', 'disabled');
      $('#save_btn').addClass('wait');
      var formData = new FormData($('form#photo_car')[0]);
      $.ajax({
        url: '/drive/photo',  //Server script to process data
        type: 'POST',
        // Form data
        data: formData,
        //Options to tell jQuery not to process data or worry about content-type.
        cache: false,
        contentType: false,
        processData: false,
        success: function(response) {
            $('#save_btn').attr('disabled','disabled');
            $('#save_btn').addClass('wait');
            // refresh img
            $("#vehicle_img").attr("src", response.img_url);
            $('#img-prev').html('');
        },
        failure: function(response) {
            console.log(response);
            $('#save_btn').removeAttr('disabled');
            $('#save_btn').removeClass('wait');
        }
      });
    });
    var input = document.getElementById("images"),
                formdata = false;
    input.addEventListener("change", function (e) {
      $('#save_btn').removeAttr('disabled');
    });
});

</script>


<script type="text/javascript" charset="utf-8">

// Called when a photo is taken
function onPhotoDataSuccess(imageData) {
    // Get a URL
    $.ajax({
        type: "GET",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        url: '/imgserv/url',
        data: JSON.stringify(data),
        success: function(response) {
          console.log(response);
          if (response.status == "ok") {
            upload = response.upload;
            $.ajax({
                type: "POST",
                contentType: "json",
                dataType: "image/jpeg",
                url: upload,
                data: imageData,
                success: function(response) {
                  console.log(response);
                }
            });
          }
        }
    });
    // show preview
    var smallImage = document.getElementById('smallImage');

    // Unhide image elements
    smallImage.style.display = 'block';

    // Show the captured photo
    // The inline CSS rules are used to resize the image
    smallImage.src = "data:image/jpeg;base64," + imageData;
}

// Called when a photo is successfully retrieved
function onPhotoURISuccess(imageURI) {
    // Uncomment to view the image file URI
    console.log(imageURI);

    // Get image handle
    var largeImage = document.getElementById('largeImage');

    // Unhide image elements
    largeImage.style.display = 'block';

    // Show the captured photo
    // The inline CSS rules are used to resize the image
    largeImage.src = imageURI;
}
</script>
{% endblock %}
